"use strict";!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(t=t||self).vest=n()}(this,(function(){function t(t,n){return t(n={exports:{}},n.exports),n.exports}function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function e(t,n,e){return n in t?Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[n]=e,t}function r(){return(r=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e,r=arguments[n];for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t}).apply(this,arguments)}function o(t,n){var e=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(t,n).enumerable}))),e.push.apply(e,r)}return e}function i(t){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?o(Object(r),!0).forEach((function(n){e(t,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(r,n))}))}return t}function u(t,n){var e=Array.isArray(t)?t:void 0;if(!e)if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t)){e=[];var r=!0,o=!1,i=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(e.push(u.value),!n||e.length!==n);r=!0);}catch(t){o=!0,i=t}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}}else e=void 0;if(!(t=e||s(t,n)))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return t}function a(t){var n=Array.isArray(t)?c(t):void 0;if(n||(n="undefined"!=typeof Symbol&&Symbol.iterator in Object(t)?Array.from(t):void 0),!(t=n||s(t)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return t}function s(t,n){if(t){if("string"==typeof t)return c(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);if("Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e)return Array.from(t);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return c(t,n)}}function c(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function f(t){return b.use().ctx?r(b.use().ctx,t):(b.use().ctx=this,r(this,t),this)}function l(t,n,e,o){r(this,{suiteId:t,testFn:o,fieldName:n,statement:e,isWarning:!1,failed:!1,id:B()})}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var d=t((function(t,n){t.exports=function(){var t=function(t){if("function"==typeof t)try{return n(t())}catch(t){return!1}return n(t)},n=function(t){return!!Array.isArray(t)||0!=t&&!!t};return function(){for(var n=arguments.length,e=Array(n),r=0;r<n;r++)e[r]=arguments[r];return e.some(t)}}()})),p=t((function(t,e){t.exports=function(){function t(){return(t=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e,r=arguments[n];for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(t[e]=r[e])}return t}).apply(this,arguments)}function e(t){return!!Array.isArray(t)}function r(t){return"number"==typeof t}function o(t){return"string"==typeof t}function i(t,n){return n instanceof RegExp?n.test(t):"string"==typeof n&&new RegExp(n).test(t)}function u(t,e){return!!(Array.isArray(e)&&["string","number","boolean"].includes(n(t))||"string"==typeof e&&"string"==typeof t)&&e.includes(t)}function a(t,n){return t===n}function s(t){return!(isNaN(parseFloat(t))||isNaN(Number(t))||!isFinite(t))}function c(t,n){return s(t)&&s(n)&&Number(t)===Number(n)}function f(t){return!t||(s(t)?0===t:Object.prototype.hasOwnProperty.call(t,"length")?0===t.length:"object"!=n(t)||0===Object.keys(t).length)}function l(t,n){return s(t)&&s(n)&&Number(t)>Number(n)}function d(t,n){return s(t)&&s(n)&&Number(t)>=Number(n)}function p(t,n){return s(t)&&s(n)&&Number(t)<Number(n)}function y(t,n){return s(t)&&s(n)&&Number(t)<=Number(n)}function v(t,n){return t.length===n}function g(t){return!!t}function h(t,e){if("function"==typeof t){for(var r=arguments.length,o=Array(2<r?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];if(!0!==t.apply(void 0,[e].concat(o)))throw Error("[Enforce]: invalid "+n(e)+" value")}}function b(n){void 0===n&&(n={});var e=t({},E,{},n);if("function"==typeof w.Proxy)return function(t){var n=new Proxy(e,{get:function(e,r){if(m(e,r))return function(){for(var o=arguments.length,i=Array(o),u=0;u<o;u++)i[u]=arguments[u];return h.apply(void 0,[e[r],t].concat(i)),n}}});return n};var r=Object.keys(e);return function(n){return r.reduce((function(r,o){var i;return t(r,t({},m(e,o)&&((i={})[o]=function(){for(var t=arguments.length,i=Array(t),u=0;u<t;u++)i[u]=arguments[u];return h.apply(void 0,[e[o],n].concat(i)),r},i)))}),{})}}var m=function(t,n){return(t=Object.prototype.hasOwnProperty.call(t,n)&&"function"==typeof t[n])||function(t){setTimeout((function(){throw Error("[enforce]: "+t)}))}('Rule "'+n+'" was not found in rules object. Make sure you typed it correctly.'),t},w=Function("return this")();e.negativeForm="isNotArray",r.negativeForm="isNotNumber",o.negativeForm="isNotString",i.negativeForm="notMatches",u.negativeForm="notInside",a.negativeForm="notEquals",s.negativeForm="isNotNumeric",c.negativeForm="numberNotEquals",f.negativeForm="isNotEmpty",l.alias="gt",d.alias="gte",p.alias="lt",y.alias="lte",v.negativeForm="lengthNotEquals",g.negativeForm="isFalsy";var E=function(t){var n,e=function(n){var e=t[n].negativeForm,r=t[n].alias;e&&(t[e]=function(){return!t[n].apply(t,arguments)}),r&&(t[r]=t[n])};for(n in t)e(n);return t}({isArray:e,isNumber:r,isString:o,matches:i,inside:u,equals:a,numberEquals:c,isNumeric:s,isEmpty:f,greaterThan:l,greaterThanOrEquals:d,lessThan:p,lessThanOrEquals:y,longerThan:function(t,n){return t.length>n},longerThanOrEquals:function(t,n){return t.length>=n},shorterThan:function(t,n){return t.length<n},shorterThanOrEquals:function(t,n){return t.length<=n},lengthEquals:v,isOdd:function(t){return!!s(t)&&0!=t%2},isEven:function(t){return!!s(t)&&0==t%2},isTruthy:g}),O=new b;return O.Enforce=b,O}()})),y=Function("return this")(),v=function(t){var n=new(1<arguments.length&&void 0!==arguments[1]?arguments[1]:Error)("[Vest]: ".concat(t));return setTimeout((function(){throw n})),n},g=Symbol.for("VEST#".concat("1")),h=function(t){return t?y[g][t]:y[g]},b={use:h,set:function(t,n){return y[g][t]=n},useContext:function(){return h().ctx},register:function(t,n){var e=y[g];return e?e.VERSION!==t.VERSION&&function(){for(var t=arguments.length,n=Array(t),e=0;e<t;e++)n[e]=arguments[e];v("Multiple versions of Vest detected: (".concat(n.join(),").\n    Most features should work regularly, but for optimal feature compatibility, you should have all running instances use the same version."))}(t.VERSION,e.VERSION):y[g]=t,n(),y[g]}};f.prototype.setCurrentTest=function(t){this.currentTest=t},f.prototype.removeCurrentTest=function(){delete this.currentTest},f.clear=function(){b.use().ctx=null};var m=function(t,n){var e=t;return b.useContext()!==t&&(e=new f(t)),t=n(e),f.clear(),t},w=function t(e){if(!e)return e;if(Array.isArray(e))return e.map(t);if("object"===n(e))for(var r in e=i({},e))e[r]=t(e[r]);return e},E=function(t,n){return!!(t=[].concat(a(t.pending),a(t.lagging))).length&&(n?t.some((function(t){return t.fieldName===n})):!!t.length)},O=Symbol("vestState"),C=Symbol("vestSuites"),S=Symbol("canceledTests"),N=function(t){return t?b.use(O)[t]:b.use(O)},x=function(t){return b.set(O,t(N())),N()},I=function(t){return x((function(n){return n[C]=t(n[C]),n})),N(C)},T=function(t){return N(C)[t]},j=function(t,n){var e,r=null!==(e=T(t))&&void 0!==e?e:[];return(n=n(e=(r=u(r,2))[0],r[1]))===e?e:T(t)[0]=n},A=function(t,n,e){var r,o;return e?!(null==t||(null===(r=t.tests)||void 0===r||null===(o=r[e])||void 0===o||!o[n])):!(null==t||!t[n])},k=function(t,n,e){var r,o,i;if(!e){for(var u in e={},t.tests){var a,s;null!==(a=t.tests)&&void 0!==a&&a[u]&&null!==(s=t.tests)&&void 0!==s&&s[u][n]&&(e[u]=t.tests[u][n])}return e}return null!==(r=null===(o=t.tests)||void 0===o||null===(i=o[e])||void 0===i?void 0:i[n])&&void 0!==r?r:[]},F=function(t){for(var n=arguments.length,e=Array(1<n?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];var o=e[(n=e.length)-1],i=e[n-2];if(e=P(t),n=i&&!t.tests[i],"function"!=typeof o||n)return e;var u=function(){return o(P(t,{draft:!0}))};return n=i&&!E(t,i),r=!E(t),n||r?(u(),e):(j(t.suiteId,(function(t){var n;i?t.fieldCallbacks[i]=(n=[]).concat.apply(n,a(t.fieldCallbacks[i]||[]).concat([u])):t.doneCallbacks.push(u);return t})),e)},P=function(t){var n,o,i=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).draft;return o={errorCount:t.errorCount,warnCount:t.warnCount,tests:t.tests,name:t.name},n=w(o),Object.defineProperties(n,[["hasErrors",A.bind(null,t,"errorCount")],["hasWarnings",A.bind(null,t,"warnCount")],["getErrors",k.bind(null,t,"errors")],["getWarnings",k.bind(null,t,"warnings")]].concat(i?[]:[["done",F.bind(null,t)]]).reduce((function(t,n){return r(t,e({},(n=u(n,2))[0],{value:n[1],writeable:!0,configurable:!0,enumerable:!0}))}),{}))},q=function(t,n){j(t,(function(t){return t.skipped[n]||((t=i({},t)).skipped[n]=!0),t}))},M=function(t){var n=T(t)[0];E(n)||I((function(n){return delete n[t],n}))},R=function(t,n){var o=n.fieldName,u=T(t)[0].lagging.reduce((function(t,n){var e=t.lagging;return t=t.canceled,n.fieldName!==o?e.push(n):t[n.id]=!0,{lagging:e,canceled:t}}),{lagging:[],canceled:{}}),a=u.lagging,s=u.canceled;j(t,(function(t){return i(i({},t),{},{lagging:a,pending:t.pending.concat(n)})})),x((function(t){return i(i({},t),{},e({},S,r(t[S],s)))}))},V=function(t){j(t.suiteId,(function(n){return i(i({},n),{},{pending:n.pending.filter((function(n){return n!==t})),lagging:n.lagging.filter((function(n){return n!==t}))})}))},W=function(t,n){if("function"==typeof n){var e=b.useContext();return e.setCurrentTest(t),t=n(),e.removeCurrentTest(),t}},D=function(t){var n=t.testFn,e=t.statement,r=t.fieldName,o=t.id,i=t.suiteId,u=b.useContext().operationMode,a=function(n){N(S)[o]||("function"==typeof n&&n(),V(t),function(t,n){t=T(t)[0],n&&!E(t,n)&&Array.isArray(t.fieldCallbacks[n])&&t.fieldCallbacks[n].forEach((function(t){return t()})),E(t)||t.doneCallbacks.forEach((function(t){return t()}))}(i,r),"STATELESS"===u&&M(i))},s=function(n){a((function(){t.statement="string"==typeof n?n:e,t.fail()}))};W(t,(function(){try{n.then(a,s)}catch(t){s()}}))},L=function(t,n){return"string"!=typeof t?v("Suite initialization error. Expected name to be a string.",TypeError):"function"!=typeof n?v("Suite initialization error. Expected tests to be a function.",TypeError):function(){var o,s=null!==(o=b.useContext())&&void 0!==o?o:{name:t,tests:n,suiteId:t,operationMode:"STATEFUL"};return m(s,(function(t){return function(){var t=b.useContext(),n=t.name,o=t.suiteId,s=T(o);if(t=[],s){var c=u(s,1)[0];t=[].concat(a(c.lagging),a(c.pending)),c.pending=null,c.lagging=null}else s=I((function(t){return t[o]=[],t}))[o];n=i(i({},{name:n,suiteId:o,pending:[],lagging:[],skipped:{},doneCallbacks:[],fieldCallbacks:{},tests:{},exclusive:{},errorCount:0,warnCount:0}),{},{lagging:t}),s.unshift(n),s.length=2,I((function(t){return r(t,e({},o,s))}))}(),t=t.suiteId,n(),function(t){j(t,(function(t,n){if(!n)return t;var e,r=i({},t);for(e in t.skipped)n.tests[e]&&!t.tests[e]&&(r.tests[e]=i({},n.tests[e]),r.errorCount+=n.tests[e].errorCount,r.warnCount+=n.tests[e].warnCount);return r}))}(t),a(T(t)[0].pending).forEach(D),P(T(t)[0])}))}},z=function(t,n){var e=b.useContext();n&&(void 0===(null==e?void 0:e.suiteId)?v("".concat(t," ").concat("hook called outside of a running suite.")):j(e.suiteId,(function(e){var r=i({},e);return[].concat(n).forEach((function(n){"string"==typeof n&&(r.exclusive[t]=r.exclusive[t]||{},r.exclusive[t][n]=!0)})),r})))},U=function(t){var n,e,r,o,i=b.useContext();return void 0!==(null==i?void 0:i.suiteId)&&(!(null===(n=(i=T(i.suiteId)[0]).exclusive)||void 0===n||null===(e=n.skip)||void 0===e||!e[t])||!(null===(r=i.exclusive)||void 0===r||!r.only)&&(null===(o=i.exclusive.only)||void 0===o||!o[t]))},$=Symbol("vestId"),B=function(){var t,n=null!==(t=b.use()[$])&&void 0!==t?t:0;return b.set($,n+1),n.toString()};l.prototype.valueOf=function(){return!0!==this.failed},l.prototype.fail=function(){var t=this,n=this.fieldName,e=this.statement;if(this.isWarning)var r="warnings",o="warnCount";else r="errors",o="errorCount";return j(this.suiteId,(function(u){if(!u.tests[t.fieldName])return u;var a=i({},u);return a.tests[n][r]=u.tests[n][r]||[],e&&a.tests[n][r].push(e),a[o]++,a.tests[n][o]++,a})),this.failed=!0,this},l.prototype.warn=function(){return this.isWarning=!0,this};var G=function(t,n){j(t,(function(t){return void 0!==t.tests[n]?t:i(i({},t),{},{tests:i(i({},t.tests),{},e({},n,{errorCount:0,warnCount:0}))})}))},H=function(t){return W(t,(function(){try{var n=t.testFn.apply(t)}catch(t){n=!1}return!1===n&&t.fail(),n}))};return b.register({Enforce:p.Enforce,create:L,VERSION:"1.0.10",any:d,draft:function(){var t=b.useContext();if(void 0!==(null==t?void 0:t.suiteId))return t=T(t.suiteId)[0],P(t,{draft:!0});v("draft hook called outside of a running suite.")},enforce:p,only:function(t){return z("only",t)},runWithContext:m,skip:function(t){return z("skip",t)},test:function(t){for(var n=arguments.length,e=Array(1<n?n-1:0),r=1;r<n;r++)e[r-1]=arguments[r];return n=e[(r=e.length)-2],e=e[r-1],r=b.useContext(),U(t)?q(r.suiteId,t):"function"==typeof e?(e=new l(r.suiteId,t,n,e),G(e.suiteId,e.fieldName),"function"==typeof(null==(n=H(e))?void 0:n.then)&&(e.testFn=n,R(e.suiteId,e)),e):void 0},validate:function(t,n){var e=B(),r=m({name:t,suiteId:e,operationMode:"STATELESS"},(function(){var e=L(t,n);if("function"==typeof e)return e()}));return M(e),r},warn:function(){var t=b.useContext();t?t.currentTest?t.currentTest.warn():v("warn hook called outside of a test callback. It won't have an effect."):v("warn hook called outside of a running suite.")}},(function(){var t,n;b.set(O,null!==(t=b.use(O))&&void 0!==t?t:(e(n={},C,{}),e(n,S,{}),n))}))}));
