"use strict";!function(n,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(n=n||self).vest=t()}(this,(function(){function n(n,t){return n(t={exports:{}},t.exports),t.exports}function t(n){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(n)}function e(n,t,e){return t in n?Object.defineProperty(n,t,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[t]=e,n}function r(){return(r=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e,r=arguments[t];for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}return n}).apply(this,arguments)}function o(n,t){var e=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable}))),e.push.apply(e,r)}return e}function i(n){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){e(n,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(r,t))}))}return n}function u(n,t){var e=Array.isArray(n)?n:void 0;if(!e)if("undefined"!=typeof Symbol&&Symbol.iterator in Object(n)){e=[];var r=!0,o=!1,i=void 0;try{for(var u,a=n[Symbol.iterator]();!(r=(u=a.next()).done)&&(e.push(u.value),!t||e.length!==t);r=!0);}catch(n){o=!0,i=n}finally{try{r||null==a.return||a.return()}finally{if(o)throw i}}}else e=void 0;if(!(n=e||s(n,t)))throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return n}function a(n){var t=Array.isArray(n)?c(n):void 0;if(t||(t="undefined"!=typeof Symbol&&Symbol.iterator in Object(n)?Array.from(n):void 0),!(n=t||s(n)))throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");return n}function s(n,t){if(n){if("string"==typeof n)return c(n,t);var e=Object.prototype.toString.call(n).slice(8,-1);if("Object"===e&&n.constructor&&(e=n.constructor.name),"Map"===e||"Set"===e)return Array.from(n);if("Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e))return c(n,t)}}function c(n,t){(null==t||t>n.length)&&(t=n.length);for(var e=0,r=Array(t);e<t;e++)r[e]=n[e];return r}function f(n){return b.use().ctx?r(b.use().ctx,n):(b.use().ctx=this,r(this,n),this)}function l(n,t,e,o){r(this,{suiteId:n,testFn:o,fieldName:t,statement:e,isWarning:!1,failed:!1,id:K()})}"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var d=n((function(n,t){n.exports=function(){var n=function(n){if("function"==typeof n)try{return t(n())}catch(n){return!1}return t(n)},t=function(n){return!!Array.isArray(n)||0!=n&&!!n};return function(){for(var t=arguments.length,e=Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.some(n)}}()})),p=n((function(n,e){n.exports=function(){function n(){return(n=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var e,r=arguments[t];for(e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}return n}).apply(this,arguments)}function e(n){return!!Array.isArray(n)}function r(n){return"number"==typeof n}function o(n){return"string"==typeof n}function i(n,t){return t instanceof RegExp?t.test(n):"string"==typeof t&&new RegExp(t).test(n)}function u(n,e){return!!(Array.isArray(e)&&["string","number","boolean"].includes(t(n))||"string"==typeof e&&"string"==typeof n)&&e.includes(n)}function a(n,t){return n===t}function s(n){return!(isNaN(parseFloat(n))||isNaN(Number(n))||!isFinite(n))}function c(n,t){return s(n)&&s(t)&&Number(n)===Number(t)}function f(n){return!n||(s(n)?0===n:Object.prototype.hasOwnProperty.call(n,"length")?0===n.length:"object"!=t(n)||0===Object.keys(n).length)}function l(n,t){return s(n)&&s(t)&&Number(n)>Number(t)}function d(n,t){return s(n)&&s(t)&&Number(n)>=Number(t)}function p(n,t){return s(n)&&s(t)&&Number(n)<Number(t)}function y(n,t){return s(n)&&s(t)&&Number(n)<=Number(t)}function g(n,t){return n.length===t}function v(n){return!!n}function h(n,e){if("function"==typeof n){for(var r=arguments.length,o=Array(2<r?r-2:0),i=2;i<r;i++)o[i-2]=arguments[i];if(!0!==n.apply(void 0,[e].concat(o)))throw Error("[Enforce]: invalid "+t(e)+" value")}}function b(t){void 0===t&&(t={});var e=n({},E,{},t);if("function"==typeof w.Proxy)return function(n){var t=new Proxy(e,{get:function(e,r){if(m(e,r))return function(){for(var o=arguments.length,i=Array(o),u=0;u<o;u++)i[u]=arguments[u];return h.apply(void 0,[e[r],n].concat(i)),t}}});return t};var r=Object.keys(e);return function(t){return r.reduce((function(r,o){var i;return n(r,n({},m(e,o)&&((i={})[o]=function(){for(var n=arguments.length,i=Array(n),u=0;u<n;u++)i[u]=arguments[u];return h.apply(void 0,[e[o],t].concat(i)),r},i)))}),{})}}var m=function(n,t){return(n=Object.prototype.hasOwnProperty.call(n,t)&&"function"==typeof n[t])||function(n){setTimeout((function(){throw Error("[enforce]: "+n)}))}('Rule "'+t+'" was not found in rules object. Make sure you typed it correctly.'),n},w=Function("return this")();e.negativeForm="isNotArray",r.negativeForm="isNotNumber",o.negativeForm="isNotString",i.negativeForm="notMatches",u.negativeForm="notInside",a.negativeForm="notEquals",s.negativeForm="isNotNumeric",c.negativeForm="numberNotEquals",f.negativeForm="isNotEmpty",l.alias="gt",d.alias="gte",p.alias="lt",y.alias="lte",g.negativeForm="lengthNotEquals",v.negativeForm="isFalsy";var E=function(n){var t,e=function(t){var e=n[t].negativeForm,r=n[t].alias;e&&(n[e]=function(){return!n[t].apply(n,arguments)}),r&&(n[r]=n[t])};for(t in n)e(t);return n}({isArray:e,isNumber:r,isString:o,matches:i,inside:u,equals:a,numberEquals:c,isNumeric:s,isEmpty:f,greaterThan:l,greaterThanOrEquals:d,lessThan:p,lessThanOrEquals:y,longerThan:function(n,t){return n.length>t},longerThanOrEquals:function(n,t){return n.length>=t},shorterThan:function(n,t){return n.length<t},shorterThanOrEquals:function(n,t){return n.length<=t},lengthEquals:g,isOdd:function(n){return!!s(n)&&0!=n%2},isEven:function(n){return!!s(n)&&0==n%2},isTruthy:v}),O=new b;return O.Enforce=b,O}()})),y=Function("return this")(),g=function(n){throw new(1<arguments.length&&void 0!==arguments[1]?arguments[1]:Error)("[Vest]: ".concat(n))},v=Symbol.for("VEST#".concat("1")),h=function(n){return n?y[v][n]:y[v]},b={use:h,set:function(n,t){return y[v][n]=t},useContext:function(){return h().ctx},register:function(n,t){var e=y[v];return e?e.VERSION!==n.VERSION&&function(){for(var n=arguments.length,t=Array(n),e=0;e<n;e++)t[e]=arguments[e];g("Multiple versions of Vest detected: (".concat(t.join(),").\n    Most features should work regularly, but for optimal feature compatibility, you should have all running instances use the same version."))}(n.VERSION,e.VERSION):y[v]=n,t(),y[v]}};f.prototype.setCurrentTest=function(n){this.currentTest=n},f.prototype.removeCurrentTest=function(){delete this.currentTest},f.clear=function(){b.use().ctx=null};var m=function(n,t){var e=n;return b.useContext()!==n&&(e=new f(n)),n=t(e),f.clear(),n},w=function n(e){if(!e)return e;if(Array.isArray(e))return e.map(n);if("object"===t(e))for(var r in e=i({},e))e[r]=n(e[r]);return e},E=function(n,t){return!!(n=[].concat(a(n.pending),a(n.lagging))).length&&(t?n.some((function(n){return n.fieldName===t})):!!n.length)},O=Symbol("vestState"),C=Symbol("vestSuites"),S=Symbol("canceledTests"),N=function(n){return n?b.use(O)[n]:b.use(O)},x=function(n){return b.set(O,n(N())),N()},I=function(n){return x((function(t){return t[C]=n(t[C]),t})),N(C)},A=function(n){return N(C)[n]},j=function(n,t){var e,r=null!==(e=A(n))&&void 0!==e?e:[];return(t=t(e=(r=u(r,2))[0],r[1]))===e?e:A(n)[0]=t},T=function(n,t,e){var r,o;return e?!(null==n||(null===(r=n.tests)||void 0===r||null===(o=r[e])||void 0===o||!o[t])):!(null==n||!n[t])},k=function(n,t,e){var r,o,i;if(!e){for(var u in e={},n.tests){var a,s;null!==(a=n.tests)&&void 0!==a&&a[u]&&null!==(s=n.tests)&&void 0!==s&&s[u][t]&&(e[u]=n.tests[u][t])}return e}return null!==(r=null===(o=n.tests)||void 0===o||null===(i=o[e])||void 0===i?void 0:i[t])&&void 0!==r?r:[]},F=function(n){for(var t=arguments.length,e=Array(1<t?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];var o=e[(t=e.length)-1],i=e[t-2];if(e=P(n),t=i&&!n.tests[i],"function"!=typeof o||t)return e;var u=function(){return o(P(n,{draft:!0}))};return t=i&&!E(n,i),r=!E(n),t||r?(u(),e):(j(n.suiteId,(function(n){var t;i?n.fieldCallbacks[i]=(t=[]).concat.apply(t,a(n.fieldCallbacks[i]||[]).concat([u])):n.doneCallbacks.push(u);return n})),e)},P=function(n){var t,o,i=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).draft;return o={errorCount:n.errorCount,warnCount:n.warnCount,tests:n.tests,name:n.name},t=w(o),Object.defineProperties(t,[["hasErrors",T.bind(null,n,"errorCount")],["hasWarnings",T.bind(null,n,"warnCount")],["getErrors",k.bind(null,n,"errors")],["getWarnings",k.bind(null,n,"warnings")]].concat(i?[]:[["done",F.bind(null,n)]]).reduce((function(n,t){return r(n,e({},(t=u(t,2))[0],{value:t[1],writeable:!0,configurable:!0,enumerable:!0}))}),{}))},q=function(){var n=b.useContext(),t=n.name,o=n.suiteId,s=A(o);if(n=[],s){var c=u(s,1)[0];n=[].concat(a(c.lagging),a(c.pending)),c.pending=null,c.lagging=null}else s=I((function(n){return n[o]=[],n}))[o];t=i(i({},{name:t,suiteId:o,pending:[],lagging:[],skipped:{},doneCallbacks:[],fieldCallbacks:{},tests:{},exclusive:{},errorCount:0,warnCount:0}),{},{lagging:n}),s.unshift(t),s.length=2,I((function(n){return r(n,e({},o,s))}))},M=function(n,t){j(n,(function(n){return n.skipped[t]||((n=i({},n)).skipped[t]=!0),n}))},R=function(n){j(n,(function(n,t){if(!t)return n;var e,r=i({},n);for(e in n.skipped)t.tests[e]&&!n.tests[e]&&(r.tests[e]=i({},t.tests[e]),r.errorCount+=t.tests[e].errorCount,r.warnCount+=t.tests[e].warnCount);return r}))},V=function(){for(var n=arguments.length,t=Array(n),o=0;o<n;o++)t[o]=arguments[o];t&&t.length&&x((function(n){return i(i({},n),{},e({},S,t.reduce((function(n,t){return r(n,e({},t.id,!0))}),n[S])))}))},W=function(n){n||g("`vest.reset` must be called with suiteId.");var t=A(n)[0];t&&(V.apply(void 0,a(t.pending||[])),V.apply(void 0,a(t.lagging||[])),I((function(t){return delete t[n],t})))},D=function(n){var t=A(n)[0];E(t)||W(n)},L=function(n,t){var e=t.fieldName,r=A(n)[0].lagging.reduce((function(n,t){var r=n.lagging;return n=n.canceled,t.fieldName!==e?r.push(t):n.push(t),{lagging:r,canceled:n}}),{lagging:[],canceled:[]}),o=r.lagging;r=r.canceled,j(n,(function(n){return i(i({},n),{},{lagging:o,pending:n.pending.concat(t)})})),V.apply(void 0,a(r))},z=function(n){j(n.suiteId,(function(t){return i(i({},t),{},{pending:t.pending.filter((function(t){return t!==n})),lagging:t.lagging.filter((function(t){return t!==n}))})}))},U=function(n,t){if("function"==typeof t){var e=b.useContext();return e.setCurrentTest(n),n=t(),e.removeCurrentTest(),n}},$=function(n){var t=n.testFn,e=n.statement,r=n.fieldName,o=n.id,i=n.suiteId,u=b.useContext().operationMode,a=function(t){var e=N(S)[o];e&&function(n){x((function(t){return delete t[S][n.id],t}))}(n),N(C)[i]&&(z(n),e||("function"==typeof t&&t(),function(n,t){n=A(n)[0],t&&!E(n,t)&&Array.isArray(n.fieldCallbacks[t])&&n.fieldCallbacks[t].forEach((function(n){return n()})),E(n)||n.doneCallbacks.forEach((function(n){return n()}))}(i,r),"STATELESS"===u&&D(i)))},s=function(t){a((function(){n.statement="string"==typeof t?t:e,n.fail()}))};U(n,(function(){try{t.then(a,s)}catch(n){s()}}))},B=function(n,t){return"string"!=typeof n?g("Suite initialization error. Expected name to be a string.",TypeError):"function"!=typeof t?g("Suite initialization error. Expected tests to be a function.",TypeError):function(){for(var e,r=arguments.length,o=Array(r),i=0;i<r;i++)o[i]=arguments[i];return r=null!==(e=b.useContext())&&void 0!==e?e:{name:n,tests:t,suiteId:n,operationMode:"STATEFUL"},m(r,(function(n){return q(),n=n.suiteId,t.apply(null,o),R(n),a(A(n)[0].pending).forEach($),P(A(n)[0])}))}},G=function(n,t){var e=b.useContext();t&&(void 0===(null==e?void 0:e.suiteId)?g("".concat(n," ").concat("hook called outside of a running suite.")):j(e.suiteId,(function(e){var r=i({},e);return[].concat(t).forEach((function(t){"string"==typeof t&&(r.exclusive[n]=r.exclusive[n]||{},r.exclusive[n][t]=!0)})),r})))},H=function(n){var t,e,r,o,i=b.useContext();return void 0!==(null==i?void 0:i.suiteId)&&(!(null===(t=(i=A(i.suiteId)[0]).exclusive)||void 0===t||null===(e=t.skip)||void 0===e||!e[n])||!(null===(r=i.exclusive)||void 0===r||!r.only)&&(null===(o=i.exclusive.only)||void 0===o||!o[n]))},J=Symbol("vestId"),K=function(){var n,t=null!==(n=b.use()[J])&&void 0!==n?n:0;return b.set(J,t+1),t.toString()};l.prototype.valueOf=function(){return!0!==this.failed},l.prototype.fail=function(){var n=this,t=this.fieldName,e=this.statement;if(this.isWarning)var r="warnings",o="warnCount";else r="errors",o="errorCount";return j(this.suiteId,(function(u){if(!u.tests[n.fieldName])return u;var a=i({},u);return a.tests[t][r]=u.tests[t][r]||[],e&&a.tests[t][r].push(e),a[o]++,a.tests[t][o]++,a})),this.failed=!0,this},l.prototype.warn=function(){return this.isWarning=!0,this};var Q=function(n,t){j(n,(function(n){return void 0!==n.tests[t]?n:i(i({},n),{},{tests:i(i({},n.tests),{},e({},t,{errorCount:0,warnCount:0}))})}))},X=function(n){return U(n,(function(){try{var t=n.testFn.apply(n)}catch(n){t=!1}return!1===t&&n.fail(),t}))};return b.register({Enforce:p.Enforce,create:B,VERSION:"1.0.10",any:d,draft:function(){var n=b.useContext();if(void 0!==(null==n?void 0:n.suiteId))return n=A(n.suiteId)[0],P(n,{draft:!0});g("draft hook called outside of a running suite.")},enforce:p,only:function(n){return G("only",n)},runWithContext:m,skip:function(n){return G("skip",n)},test:function(n){for(var t=arguments.length,e=Array(1<t?t-1:0),r=1;r<t;r++)e[r-1]=arguments[r];return t=e[(r=e.length)-2],e=e[r-1],r=b.useContext(),H(n)?M(r.suiteId,n):"function"==typeof e?(e=new l(r.suiteId,n,t,e),Q(e.suiteId,e.fieldName),"function"==typeof(null==(t=X(e))?void 0:t.then)&&(e.testFn=t,L(e.suiteId,e)),e):void 0},validate:function(n,t){var e=K(),r=m({name:n,suiteId:e,operationMode:"STATELESS"},(function(){var e=B(n,t);if("function"==typeof e)return e()}));return D(e),r},warn:function(){var n=b.useContext();n?n.currentTest?n.currentTest.warn():g("warn hook called outside of a test callback. It won't have an effect."):g("warn hook called outside of a running suite.")},reset:W},(function(){var n,t;b.set(O,null!==(n=b.use(O))&&void 0!==n?n:(e(t={},C,{}),e(t,S,{}),t))}))}));
